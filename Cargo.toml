[package]
name = "s2-voronoi"
version = "0.1.0"
edition = "2021"
description = "Spherical Voronoi diagrams on the unit sphere (S2)"
readme = "README.md"
license = "MIT OR Apache-2.0"
keywords = ["voronoi", "sphere", "geometry", "s2"]
categories = ["algorithms", "mathematics", "science"]

[features]
default = ["parallel"]
parallel = ["rayon"]
glam = []  # Enable UnitVec3Like impl for glam::Vec3
timing = []  # Enable detailed timing instrumentation
profiling = [] # Profiling helpers (e.g. disable inlining on hot functions)
microbench = ["dep:rand", "dep:rand_chacha"] # Enable internal microbench harnesses (nightly `test` crate)
qhull = ["qhull-enhanced"]  # Convex hull backend (test/bench only)
simd_clip = [] # Use SIMD small-N clippers in main clipper dispatch
fma = [] # Prefer fused multiply-add via mul_add (may change results; can be slow without HW FMA)
packed_knn_sort_small = [] # Use crate::sort::sort_small for small packed-kNN sorts
tools = ["dep:clap", "dep:kiddo", "dep:rand", "dep:rand_chacha"] # Benchmark/utility binaries

[dependencies]
clap = { version = "4", features = ["derive"], optional = true }
kiddo = { version = "4", optional = true }
rand = { version = "0.8", optional = true }
rand_chacha = { version = "0.3", optional = true }
# Math (always internal dependency)
glam = { version = "0.29", features = ["bytemuck"] }
bytemuck = { version = "1.19", features = ["derive"] }

# Fast hashing for integer keys
rustc-hash = "2"

# Optional: parallelism
rayon = { version = "1.10", optional = true }

# Optional: convex hull backend (test-only)
qhull-enhanced = { version = "0.1", optional = true }

[dev-dependencies]
rand = "0.8"
rand_chacha = "0.3"

[[bin]]
name = "bench_voronoi"
path = "src/bin/bench_voronoi.rs"
required-features = ["tools"]

[[bin]]
name = "bench_bins"
path = "src/bin/bench_bins.rs"
required-features = ["tools", "parallel"]

[[bin]]
name = "microbench_clip"
path = "src/bin/microbench_clip.rs"
required-features = ["microbench"]

[[bin]]
name = "microbench_batch"
path = "src/bin/microbench_batch.rs"
required-features = ["microbench"]

[[bin]]
name = "microbench_packed_select"
path = "src/bin/microbench_packed_select.rs"
required-features = ["microbench"]

[profile.checked]
inherits = "release"
opt-level = 3
debug = true
debug-assertions = true

[profile.checked.package."*"]
debug = false
debug-assertions = false

[profile.profiled]
inherits = "release"
opt-level = 3
debug = 1
lto = false
codegen-units = 1
strip = "none"
